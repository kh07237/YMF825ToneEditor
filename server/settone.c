#include <stdio.h>
#include <string.h>
#include <time.h>
#include <sys/time.h>
#include <unistd.h> 
#include <bcm2835.h>

#include "fmif.h"
#include "fmsd1.h"

int notes[5] = {0x3c,0x40,0x42,0x46,0x4e};

ToneData tone_data = 
	{	//	初期値GrandPiano
		0x0b,	//	VoiceCommon
		{ //  KC | AR | DR | SR | RR | SL | TL | VB | PT | WS
			{0x0a,0x0f,0x07,0x00,0x06,0x0f,0x27,0x00,0x01,0x08},	// op1
			{0x0a,0x0e,0x03,0x02,0x03,0x02,0x28,0x00,0x05,0x00},	// op2
			{0x00,0x07,0x01,0x01,0x04,0x03,0x22,0x01,0x01,0x09},	// op3
			{0x06,0x0d,0x02,0x02,0x06,0x04,0x00,0x01,0x01,0x00}		// op4
		}
	};
ToneData tenorsax = 
	{	//	TenorSax
		0x0d,	//	VoiceCommon
		{ //  KC | AR | DR | SR | RR | SL | TL | VB | PT | WS
			{0x36,0x07,0x03,0x00,0x00,0x00,0x05,0x44,0x01,0x01},	// op1
			{0x00,0x07,0x02,0x00,0x09,0x00,0x0f,0x43,0x01,0x08},	// op2
			{0x36,0x07,0x03,0x00,0x00,0x00,0x08,0x44,0x01,0x09},	// op3
			{0x02,0x07,0x02,0x00,0x09,0x00,0x0d,0x43,0x01,0x00}		// op4
		}
    };



int main(int argc, char *argv[])
{
    int note=0x0d;
    int i=0;

    if (!bcm2835_init()) return 1;

    initSPI();
    initSD1();
    Fmdriver_init();

    printf("%s\n",argv[1]);

    Fmdriver_SetTome(tenorsax,0);

    //Program Change   
    Fmdriver_sendMidi(0xc0);
    Fmdriver_sendMidi(8);

    //note on
    for(i=0; i<1; i++){
        Fmdriver_sendMidi(0x90);
        Fmdriver_sendMidi(notes[i]);
        Fmdriver_sendMidi(0x7f);
    }
    sleep(1);

    //note off
    for(i=0; i<5; i++){
        Fmdriver_sendMidi(0x80);
        Fmdriver_sendMidi(notes[i]);
        Fmdriver_sendMidi(0x7f);
    }
    sleep(1);
}